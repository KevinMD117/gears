BootStrap: docker
From: physino/geant4

%help
Container of the latest Geant4 on the latest Fedora

%post
sed -i 's|/root/gears/INSTALL|$HOME|g' /usr/bin/geant4.sh
sed -i 's|/root/gears/INSTALL|~|g' /usr/bin/geant4-config

# https://unix.stackexchange.com/a/341244/26929
# https://stackoverflow.com/a/18185387/1801749
sed -i 's|dataset_path=|eval dataset_path=|g' /usr/bin/geant4-config

echo '#!/bin/sh' > /.singularity.d/env/99-geant4.sh
sed -n '/HOME/p' /usr/bin/geant4.sh >> /.singularity.d/env/99-g4.sh
# customize container PS1 (https://stackoverflow.com/a/61251143)
echo 'PS1="\u@geant4.11.0.2:\w \$ "' >> /.singularity.d/env/99-g4.sh

%environment
export LANG=C.UTF-8
export LC_ALL=C.UTF-8
# https://github.com/apptainer/singularity/issues/643
# settings in ~/.bashrc will be loaded last
export SINGULARITY_SHELL=/usr/bin/bash

%runscript
gears "$@"
